<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Estimate Riesz representer for ecological inference — ei_riesz • seine</title><!-- mathjax math --><script src="https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/tex-mml-chtml.js" integrity="sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI=" crossorigin="anonymous"></script><script>
  window.MathJax = {
    chtml: {
      fontURL: "https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/output/chtml/fonts/woff-v2"
    }
  };
</script><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Estimate Riesz representer for ecological inference — ei_riesz"><meta name="description" content="Fits a penalized Riesz regression for ecological inference, allowing for
overall estimates of conditional means using ei_est()."><meta property="og:description" content="Fits a penalized Riesz regression for ecological inference, allowing for
overall estimates of conditional means using ei_est()."><meta property="og:image" content="https://corymccartan.com/seine/logo.svg"><!-- Google tag (gtag.js) --><script async src="https://www.googletagmanager.com/gtag/js?id=G-2KH5JZ6JS1"></script><script>
window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());

gtag('config', 'G-2KH5JZ6JS1');
</script></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">seine</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.0.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/CoryMcCartan/seine/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.svg" class="logo" alt=""><h1>Estimate Riesz representer for ecological inference</h1>
      <small class="dont-index">Source: <a href="https://github.com/CoryMcCartan/seine/blob/main/R/ei_riesz.R" class="external-link"><code>R/ei_riesz.R</code></a></small>
      <div class="d-none name"><code>ei_riesz.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Fits a penalized Riesz regression for ecological inference, allowing for
overall estimates of conditional means using <code><a href="ei_est.html">ei_est()</a></code>.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">ei_riesz</span><span class="op">(</span><span class="va">x</span>, <span class="va">...</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># S3 method for class 'formula'</span></span>
<span><span class="fu">ei_riesz</span><span class="op">(</span><span class="va">formula</span>, <span class="va">data</span>, <span class="va">total</span>, <span class="va">weights</span>, <span class="va">penalty</span>, scale <span class="op">=</span> <span class="cn">TRUE</span>, <span class="va">...</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># S3 method for class 'ei_spec'</span></span>
<span><span class="fu">ei_riesz</span><span class="op">(</span><span class="va">x</span>, <span class="va">weights</span>, <span class="va">penalty</span>, scale <span class="op">=</span> <span class="cn">TRUE</span>, <span class="va">...</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># S3 method for class 'data.frame'</span></span>
<span><span class="fu">ei_riesz</span><span class="op">(</span><span class="va">x</span>, <span class="va">z</span>, <span class="va">total</span>, <span class="va">weights</span>, <span class="va">penalty</span>, scale <span class="op">=</span> <span class="cn">TRUE</span>, <span class="va">...</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># S3 method for class 'matrix'</span></span>
<span><span class="fu">ei_riesz</span><span class="op">(</span><span class="va">x</span>, <span class="va">z</span>, <span class="va">total</span>, <span class="va">weights</span>, <span class="va">penalty</span>, scale <span class="op">=</span> <span class="cn">TRUE</span>, <span class="va">...</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Default S3 method</span></span>
<span><span class="fu">ei_riesz</span><span class="op">(</span><span class="va">x</span>, <span class="va">...</span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-x">x<a class="anchor" aria-label="anchor" href="#arg-x"></a></dt>
<dd><p>Depending on the context:</p><ul><li><p>A <strong>data frame</strong> of predictors.</p></li>
<li><p>A <strong>matrix</strong> of predictors.</p></li>
<li><p>An <a href="ei_spec.html">ei_spec</a> object containing the outcome, predictor, and covariates.</p></li>
</ul><p>Predictors must be proportions that sum to 1 across rows.
You can use <code><a href="ei_proportions.html">ei_proportions()</a></code> to assist in preparing predictor variables.
Covariates in an <a href="ei_spec.html">ei_spec</a> object are shifted to have mean zero. If
<code>scale=TRUE</code> (the default), they are also scaled to have unit variance.</p></dd>


<dt id="arg--">...<a class="anchor" aria-label="anchor" href="#arg--"></a></dt>
<dd><p>Not currently used, but required for extensibility.</p></dd>


<dt id="arg-formula">formula<a class="anchor" aria-label="anchor" href="#arg-formula"></a></dt>
<dd><p>A formula such as <code>y ~ x0 + x1 | z</code> specifying the outcome <code>y</code>
regressed on the predictors of interest <code>x</code> and any covariates <code>z</code>.
The predictors should form a partition, that is, <code>x0 + x1 = 1</code> for each
observation. Users can be include more than two predictors as well, e.g.
<code>pct_white + pct_black + pct_hisp + pct_other</code>.
If there are just two predictors, it is acceptable to only include one in
the formula; the other will be formed as 1 minus the provided predictor.
Include additional covariates separated by a vertical bar <code>|</code>.
These covariates are strongly recommended for reliable ecological inference.
Covariates are shifted to have mean zero. If <code>scale=TRUE</code> (the default),
they are also scaled to have unit variance.</p></dd>


<dt id="arg-data">data<a class="anchor" aria-label="anchor" href="#arg-data"></a></dt>
<dd><p>When a <strong>formula</strong> is used, <code>data</code> is a <strong>data frame</strong> containing
both the predictors and the outcome.</p></dd>


<dt id="arg-total">total<a class="anchor" aria-label="anchor" href="#arg-total"></a></dt>
<dd><p>&lt;<code><a href="https://tidyselect.r-lib.org/reference/language.html" class="external-link">tidy-select</a></code>&gt; A variable
containing the total number of observations in each aggregate unit. For
example, the column containing the total number of voters. Required by
default.</p></dd>


<dt id="arg-weights">weights<a class="anchor" aria-label="anchor" href="#arg-weights"></a></dt>
<dd><p>&lt;<code><a href="https://rlang.r-lib.org/reference/args_data_masking.html" class="external-link">data-masking</a></code>&gt; A vector of unit
weights for estimation. These may be the same or different from the total
number of observations in each aggregate unit (see the <code>total</code> argument to
<code><a href="ei_spec.html">ei_spec()</a></code>). See the discussion below under 'Weights' for choosing this
parameter. The default, uniform weights, makes a slightly
stronger-than-necessary assumption about the relationship between the
unit totals and the unknown data.</p></dd>


<dt id="arg-penalty">penalty<a class="anchor" aria-label="anchor" href="#arg-penalty"></a></dt>
<dd><p>The ridge penalty (a non-negative scalar), which must be
specified. Recommended value is the same penalty used in <code><a href="ei_ridge.html">ei_ridge()</a></code>,
which is stored in the <code>penalty</code> entry of the fitted model object.</p></dd>


<dt id="arg-scale">scale<a class="anchor" aria-label="anchor" href="#arg-scale"></a></dt>
<dd><p>If <code>TRUE</code>, scale covariates <code>z</code> to have unit variance.</p></dd>


<dt id="arg-z">z<a class="anchor" aria-label="anchor" href="#arg-z"></a></dt>
<dd><p>When <code>x</code> is a <strong>data frame</strong> or <strong>matrix</strong>, <code>w</code> are any covariates,
specified as:</p><ul><li><p>A <strong>data frame</strong> with numeric columns.</p></li>
<li><p>A <strong>matrix</strong></p></li>
</ul><p>These are shifted to have mean zero. If <code>scale=TRUE</code> (the default), they
are also scaled to have unit variance.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>An <code>ei_riesz</code> object.</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>The regression is calculated using the singular value decomposition.</p>
    </div>
    <div class="section level2">
    <h2 id="weights">Weights<a class="anchor" aria-label="anchor" href="#weights"></a></h2>


<p>The weakest identification result for ecological inference makes no
assumption about the number of observations per aggregate unit (the totals).
It requires, however, weighting the estimation steps according to the totals.
This may reduce efficiency when the totals are variable and a slightly
stronger condition holds.</p>
<p>Specifically, if the totals are conditionally mean-independent of the missing
data (the aggregation-unit level means of the outcome within each predictor
level), given covariates, then it is appropriate to use uniform weights in
estimation, or any fixed set of weights.</p>
<p>In general, estimation efficiency is improved when units with larger variance
in the outcome receive less weight. Various bulit-in options are provided by
the helper functions in <code><a href="ei_wgt.html">ei_wgt()</a></code>.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">elec_1968</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Recommended: get ridge penalty from ei_ridge()</span></span></span>
<span class="r-in"><span><span class="va">spec</span> <span class="op">=</span> <span class="fu"><a href="ei_spec.html">ei_spec</a></span><span class="op">(</span><span class="va">elec_1968</span>, <span class="va">vap_white</span><span class="op">:</span><span class="va">vap_other</span>, <span class="va">pres_dem_hum</span><span class="op">:</span><span class="va">pres_abs</span>,</span></span>
<span class="r-in"><span>               total <span class="op">=</span> <span class="va">pres_total</span>, covariates <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">pop_urban</span>, <span class="va">farm</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">m</span> <span class="op">=</span> <span class="fu"><a href="ei_ridge.html">ei_ridge</a></span><span class="op">(</span><span class="va">spec</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu">ei_riesz</span><span class="op">(</span><span class="va">spec</span>, penalty <span class="op">=</span> <span class="va">m</span><span class="op">$</span><span class="va">penalty</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> A Riesz representer with 3 groups and 1143 observations</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Fit with penalty = 1.01453e-08</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">rr</span> <span class="op">=</span> <span class="fu">ei_riesz</span><span class="op">(</span><span class="op">~</span> <span class="va">vap_white</span> <span class="op">+</span> <span class="va">vap_black</span> <span class="op">+</span> <span class="va">vap_other</span> <span class="op">|</span> <span class="va">pop_urban</span> <span class="op">+</span> <span class="va">farm</span>,</span></span>
<span class="r-in"><span>              data <span class="op">=</span> <span class="va">elec_1968</span>, total <span class="op">=</span> <span class="va">pres_total</span>, penalty <span class="op">=</span> <span class="va">m</span><span class="op">$</span><span class="va">penalty</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">rr</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Second moment of representer:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    vap_white    vap_black    vap_other </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     4.461456    48.486776 31468.779992 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Second moment of representer (leave-one-out):</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   vap_white   vap_black   vap_other </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     4.98174    51.34839 42521.67381 </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Examine the weights and check they have mean 1</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/weights.html" class="external-link">weights</a></span><span class="op">(</span><span class="va">rr</span>, group <span class="op">=</span> <span class="st">"vap_black"</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1]  3.3584139 -0.9872354  8.7084517  4.6428913 -4.6285576  6.0225661</span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">colMeans</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/weights.html" class="external-link">weights</a></span><span class="op">(</span><span class="va">rr</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> vap_white vap_black vap_other </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1.0000000 1.0000000 0.9999999 </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">elec_1968</span><span class="op">$</span><span class="va">pres_ind_wal</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/stats/weights.html" class="external-link">weights</a></span><span class="op">(</span><span class="va">rr</span>, <span class="st">"vap_white"</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 0.3633165</span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Cory McCartan, Shiro Kuriwaki.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer></div>





  </body></html>

