<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Fit an ecological inference regression model — ei_ridge • seine</title><!-- mathjax math --><script src="https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/tex-mml-chtml.js" integrity="sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI=" crossorigin="anonymous"></script><script>
  window.MathJax = {
    chtml: {
      fontURL: "https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/output/chtml/fonts/woff-v2"
    }
  };
</script><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Fit an ecological inference regression model — ei_ridge"><meta name="description" content="Fits a penalized regression model for ecological inference, allowing for
overall and unit-level estimates of conditional means using ei_est()."><meta property="og:description" content="Fits a penalized regression model for ecological inference, allowing for
overall and unit-level estimates of conditional means using ei_est()."><meta property="og:image" content="https://corymccartan.com/seine/logo.svg"><!-- Google tag (gtag.js) --><script async src="https://www.googletagmanager.com/gtag/js?id=G-2KH5JZ6JS1"></script><script>
window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());

gtag('config', 'G-2KH5JZ6JS1');
</script></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">seine</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.0.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="../articles/seine.html">Get started</a></li>
<li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/CoryMcCartan/seine/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.svg" class="logo" alt=""><h1>Fit an ecological inference regression model</h1>
      <small class="dont-index">Source: <a href="https://github.com/CoryMcCartan/seine/blob/main/R/ei_ridge.R" class="external-link"><code>R/ei_ridge.R</code></a></small>
      <div class="d-none name"><code>ei_ridge.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Fits a penalized regression model for ecological inference, allowing for
overall and unit-level estimates of conditional means using <code><a href="ei_est.html">ei_est()</a></code>.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">ei_ridge</span><span class="op">(</span><span class="va">x</span>, <span class="va">...</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># S3 method for class 'formula'</span></span>
<span><span class="fu">ei_ridge</span><span class="op">(</span></span>
<span>  <span class="va">formula</span>,</span>
<span>  <span class="va">data</span>,</span>
<span>  <span class="va">weights</span>,</span>
<span>  bounds <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  penalty <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  scale <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  vcov <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  <span class="va">...</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># S3 method for class 'ei_spec'</span></span>
<span><span class="fu">ei_ridge</span><span class="op">(</span></span>
<span>  <span class="va">x</span>,</span>
<span>  <span class="va">weights</span>,</span>
<span>  bounds <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  penalty <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  scale <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  vcov <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  <span class="va">...</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># S3 method for class 'data.frame'</span></span>
<span><span class="fu">ei_ridge</span><span class="op">(</span></span>
<span>  <span class="va">x</span>,</span>
<span>  <span class="va">y</span>,</span>
<span>  <span class="va">z</span>,</span>
<span>  <span class="va">weights</span>,</span>
<span>  bounds <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  penalty <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  scale <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  vcov <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  <span class="va">...</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># S3 method for class 'matrix'</span></span>
<span><span class="fu">ei_ridge</span><span class="op">(</span></span>
<span>  <span class="va">x</span>,</span>
<span>  <span class="va">y</span>,</span>
<span>  <span class="va">z</span>,</span>
<span>  <span class="va">weights</span>,</span>
<span>  bounds <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  penalty <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  scale <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  vcov <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  <span class="va">...</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Default S3 method</span></span>
<span><span class="fu">ei_ridge</span><span class="op">(</span><span class="va">x</span>, <span class="va">...</span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-x">x<a class="anchor" aria-label="anchor" href="#arg-x"></a></dt>
<dd><p>Depending on the context:</p><ul><li><p>A <strong>data frame</strong> of predictors.</p></li>
<li><p>A <strong>matrix</strong> of predictors.</p></li>
<li><p>An <a href="ei_spec.html">ei_spec</a> object containing the outcome, predictor, and covariates.</p></li>
</ul><p>Predictors must be proportions that sum to 1 across rows.
You can use <code><a href="ei_proportions.html">ei_proportions()</a></code> to assist in preparing predictor variables.
Covariates in an <a href="ei_spec.html">ei_spec</a> object are shifted to have mean zero. If
<code>scale=TRUE</code> (the default), they are also scaled to have unit variance.</p></dd>


<dt id="arg--">...<a class="anchor" aria-label="anchor" href="#arg--"></a></dt>
<dd><p>Not currently used, but required for extensibility.</p></dd>


<dt id="arg-formula">formula<a class="anchor" aria-label="anchor" href="#arg-formula"></a></dt>
<dd><p>A formula such as <code>y ~ x0 + x1 | z</code> specifying the outcome <code>y</code>
regressed on the predictors of interest <code>x</code> and any covariates <code>z</code>.
The predictors should form a partition, that is, <code>x0 + x1 = 1</code> for each
observation. Users can be include more than two predictors as well, e.g.
<code>pct_white + pct_black + pct_hisp + pct_other</code>.
If there are just two predictors, it is acceptable to only include one in
the formula; the other will be formed as 1 minus the provided predictor.
Include additional covariates separated by a vertical bar <code>|</code>.
These covariates are strongly recommended for reliable ecological inference.
Covariates are shifted to have mean zero. If <code>scale=TRUE</code> (the default),
they are also scaled to have unit variance.</p></dd>


<dt id="arg-data">data<a class="anchor" aria-label="anchor" href="#arg-data"></a></dt>
<dd><p>When a <strong>formula</strong> is used, <code>data</code> is a <strong>data frame</strong> containing
both the predictors and the outcome.</p></dd>


<dt id="arg-weights">weights<a class="anchor" aria-label="anchor" href="#arg-weights"></a></dt>
<dd><p>&lt;<code><a href="https://rlang.r-lib.org/reference/args_data_masking.html" class="external-link">data-masking</a></code>&gt; A vector of unit
weights for estimation. These may be the same or different from the total
number of observations in each aggregate unit (see the <code>total</code> argument to
<code><a href="ei_spec.html">ei_spec()</a></code>). See the discussion below under 'Weights' for choosing this
parameter. The default, uniform weights, makes a slightly
stronger-than-necessary assumption about the relationship between the
unit totals and the unknown data.</p></dd>


<dt id="arg-bounds">bounds<a class="anchor" aria-label="anchor" href="#arg-bounds"></a></dt>
<dd><p>A vector <code>c(min, max)</code> of bounds for the outcome.
If <code>bounds = NULL</code>, they will be inferred from the outcome variable:
if it is contained within \([0, 1]\), for instance, then the bounds will
be <code>c(0, 1)</code>. The default <code>bounds = FALSE</code> uses an unbounded outcome.</p></dd>


<dt id="arg-penalty">penalty<a class="anchor" aria-label="anchor" href="#arg-penalty"></a></dt>
<dd><p>The ridge penalty (a non-negative scalar). Set to <code>NULL</code> to
automatically determine the penalty which minimizes mean-square error,
via an efficient leave-one-out cross validation procedure.
The ridge regression solution is
$$\hat\beta = (X^\top X + \lambda I)^{-1}X^\top y,$$
where \(\lambda\) is the value of <code>penalty</code>.
One can equivalently think of the penalty as imposing a
\(\mathcal{N}(0, \sigma^2/\lambda^2)\) prior on the \(\beta\).
Keep in mind when choosing <code>penalty</code> manually that covariates in <code>z</code> are
scaled to have mean zero and unit variance before fitting.</p></dd>


<dt id="arg-scale">scale<a class="anchor" aria-label="anchor" href="#arg-scale"></a></dt>
<dd><p>If <code>TRUE</code>, scale covariates <code>z</code> to have unit variance.</p></dd>


<dt id="arg-vcov">vcov<a class="anchor" aria-label="anchor" href="#arg-vcov"></a></dt>
<dd><p>If <code>TRUE</code>, calculate and return the covariance matrix of the
estimated coefficients. Ignored when <code>bounds</code> are provided.</p></dd>


<dt id="arg-y">y<a class="anchor" aria-label="anchor" href="#arg-y"></a></dt>
<dd><p>When <code>x</code> is a <strong>data frame</strong> or <strong>matrix</strong>, <code>y</code> is the outcome
specified as:</p><ul><li><p>A <strong>data frame</strong> with numeric columns.</p></li>
<li><p>A <strong>matrix</strong></p></li>
<li><p>A numeric <strong>vector</strong>.</p></li>
</ul><p>When the outcome is a proportion, you can use <code><a href="ei_proportions.html">ei_proportions()</a></code> to assist
in preparing it.</p></dd>


<dt id="arg-z">z<a class="anchor" aria-label="anchor" href="#arg-z"></a></dt>
<dd><p>When <code>x</code> is a <strong>data frame</strong> or <strong>matrix</strong>, <code>w</code> are any covariates,
specified as:</p><ul><li><p>A <strong>data frame</strong> with numeric columns.</p></li>
<li><p>A <strong>matrix</strong></p></li>
</ul><p>These are shifted to have mean zero. If <code>scale=TRUE</code> (the default), they
are also scaled to have unit variance.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>An <code>ei_ridge</code> object, which supports various <a href="ridge-methods.html">ridge-methods</a>.</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>The regression is calculated using the singular value decomposition, which
allows for efficient recalculation under different <code>penalty</code> values as part
of leave-one-out cross-validation.
When <code>bounds</code> are provided, the regression is calculated via quadratic
programming, as there is no closed-form solution. The unbounded regression
is run to select the <code>penalty</code> automatically in this case, if it is not
provided. Estimation is still efficient, though somewhat slower than in the
unbounded case. The covariance matrix of the estimates is not available when
bounds are applied.</p>
    </div>
    <div class="section level2">
    <h2 id="weights">Weights<a class="anchor" aria-label="anchor" href="#weights"></a></h2>


<p>The weakest identification result for ecological inference makes no
assumption about the number of observations per aggregate unit (the totals).
It requires, however, weighting the estimation steps according to the totals.
This may reduce efficiency when the totals are variable and a slightly
stronger condition holds.</p>
<p>Specifically, if the totals are conditionally mean-independent of the missing
data (the aggregation-unit level means of the outcome within each predictor
level), given covariates, then it is appropriate to use uniform weights in
estimation, or any fixed set of weights.</p>
<p>In general, estimation efficiency is improved when units with larger variance
in the outcome receive less weight. Various bulit-in options are provided by
the helper functions in <code><a href="ei_wgt.html">ei_wgt()</a></code>.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">elec_1968</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">spec</span> <span class="op">=</span> <span class="fu"><a href="ei_spec.html">ei_spec</a></span><span class="op">(</span><span class="va">elec_1968</span>, <span class="va">vap_white</span><span class="op">:</span><span class="va">vap_other</span>, <span class="va">pres_dem_hum</span><span class="op">:</span><span class="va">pres_abs</span>,</span></span>
<span class="r-in"><span>               total <span class="op">=</span> <span class="va">pres_total</span>, covariates <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">pop_urban</span>, <span class="va">farm</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu">ei_ridge</span><span class="op">(</span><span class="va">spec</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> An ecological inference model with 4 outcomes, 3 groups, and 1143 observations</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Fit with penalty = 1.01453e-08</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu">ei_ridge</span><span class="op">(</span><span class="va">pres_dem_hum</span> <span class="op">+</span> <span class="va">pres_rep_nix</span> <span class="op">+</span> <span class="va">pres_ind_wal</span> <span class="op">+</span> <span class="va">pres_abs</span> <span class="op">~</span></span></span>
<span class="r-in"><span>      <span class="va">vap_white</span> <span class="op">+</span> <span class="va">vap_black</span> <span class="op">+</span> <span class="va">vap_other</span> <span class="op">|</span> <span class="va">pop_urban</span> <span class="op">+</span> <span class="va">farm</span>, data <span class="op">=</span> <span class="va">elec_1968</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> An ecological inference model with 4 outcomes, 3 groups, and 1143 observations</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Fit with penalty = 1.01453e-08</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># bounds inferred</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/all.equal.html" class="external-link">all.equal</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/stats/fitted.values.html" class="external-link">fitted</a></span><span class="op">(</span><span class="fu">ei_ridge</span><span class="op">(</span><span class="va">spec</span>, bounds <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/stats/fitted.values.html" class="external-link">fitted</a></span><span class="op">(</span><span class="fu">ei_ridge</span><span class="op">(</span><span class="va">spec</span>, bounds <span class="op">=</span> <span class="fl">0</span><span class="op">:</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] TRUE</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># bounds enforced</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/fitted.values.html" class="external-link">fitted</a></span><span class="op">(</span><span class="fu">ei_ridge</span><span class="op">(</span><span class="va">spec</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] -0.1029559</span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/fitted.values.html" class="external-link">fitted</a></span><span class="op">(</span><span class="fu">ei_ridge</span><span class="op">(</span><span class="va">spec</span>, bounds <span class="op">=</span> <span class="fl">0</span><span class="op">:</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] -3.377815e-19</span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Cory McCartan, Shiro Kuriwaki.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer></div>





  </body></html>

